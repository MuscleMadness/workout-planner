"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2293],{2293:(X,f,c)=>{c.r(f),c.d(f,{MembershipPageModule:()=>$});var m=c(177),u=c(9417),i=c(5374),h=c(8498),I=c(467),b=c(6098),_=c(5933),e=c(3953),y=c(9747),M=c(5679),P=c(345);function R(r,a){1&r&&e.nrm(0,"ion-spinner")}function k(r,a){if(1&r){const o=e.RV6();e.j41(0,"ion-button",7),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.registerUser())}),e.EFF(1,"Register"),e.k0s()}}function v(r,a){if(1&r&&(e.j41(0,"ion-card")(1,"ion-card-content")(2,"ion-text",5),e.EFF(3),e.k0s(),e.DNE(4,k,2,0,"ion-button",6),e.k0s()()),2&r){const o=e.XpG();e.R7$(3),e.JRh(o.error),e.R7$(),e.Y8G("ngIf",o.showRegisterButton)}}function U(r,a){if(1&r){const o=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-card-subtitle"),e.EFF(5),e.k0s()(),e.j41(6,"ion-card-content")(7,"div",8)(8,"ion-button",9),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.callGym(n.gymInfo.contactNumber))}),e.nrm(9,"ion-icon",10),e.EFF(10," Call "),e.k0s()()()()}if(2&r){const o=e.XpG();e.R7$(3),e.JRh(o.gymInfo.name),e.R7$(2),e.JRh(o.gymInfo.address)}}function N(r,a){if(1&r){const o=e.RV6();e.j41(0,"ion-item")(1,"ion-item")(2,"ion-label",11),e.EFF(3,"Enter your Phone Number"),e.k0s(),e.j41(4,"ion-input",12),e.mxI("ngModelChange",function(n){e.eBV(o);const s=e.XpG();return e.DH7(s.phoneNumber,n)||(s.phoneNumber=n),e.Njj(n)}),e.k0s()(),e.j41(5,"ion-button",13),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.checkUser())}),e.EFF(6,"Proceed"),e.k0s()()}if(2&r){const o=e.XpG();e.R7$(4),e.R50("ngModel",o.phoneNumber)}}function x(r,a){if(1&r){const o=e.RV6();e.j41(0,"div")(1,"p")(2,"strong"),e.EFF(3,"Phone:"),e.k0s(),e.EFF(4),e.k0s(),e.j41(5,"p")(6,"strong"),e.EFF(7,"Address:"),e.k0s(),e.EFF(8),e.k0s(),e.j41(9,"p")(10,"strong"),e.EFF(11,"Membership:"),e.k0s(),e.j41(12,"ion-text",17),e.EFF(13),e.k0s()(),e.j41(14,"ion-button",18),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.clearUserInfo())}),e.EFF(15," Log out "),e.k0s()()}if(2&r){const o=e.XpG(2);e.R7$(4),e.SpI(" ",o.userInfo.phoneNumber,""),e.R7$(4),e.SpI(" ",o.userInfo.address,""),e.R7$(4),e.Y8G("ngStyle",o.DateUtils.getExpiryStyle(o.DateUtils.calculateExpiryInDays(o.userInfo.expiryDate))),e.R7$(),e.SpI(" ",o.DateUtils.getExpiryStatus(o.DateUtils.calculateExpiryInDays(o.userInfo.expiryDate))," ")}}function C(r,a){if(1&r&&e.nrm(0,"img",22),2&r){const o=e.XpG(3);e.Y8G("src",o.qrCodeDataUrl,e.B4B)}}function G(r,a){if(1&r){const o=e.RV6();e.j41(0,"div",19),e.DNE(1,C,1,1,"img",20),e.j41(2,"ion-button",21),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.downloadQRCode())}),e.EFF(3," Download QR "),e.k0s()()}if(2&r){const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",o.qrCodeDataUrl)}}function j(r,a){if(1&r){const o=e.RV6();e.j41(0,"ion-card")(1,"ion-button",14),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.showQr=!n.showQr)}),e.nrm(2,"ion-icon",15),e.k0s(),e.j41(3,"ion-card-header")(4,"ion-card-title"),e.EFF(5),e.k0s()(),e.j41(6,"ion-card-content"),e.DNE(7,x,16,4,"div",4)(8,G,4,1,"div",16),e.k0s()()}if(2&r){const o=e.XpG();e.R7$(2),e.Y8G("name",o.showQr?"person-circle-outline":"qr-code-outline"),e.R7$(3),e.SpI(" ",o.userInfo.name," "),e.R7$(2),e.Y8G("ngIf",!o.showQr),e.R7$(),e.Y8G("ngIf",o.showQr)}}const F=[{path:"",component:(()=>{var r;class a{constructor(t,n,s,l,g,d){this.route=t,this.router=n,this.iab=s,this.alertController=l,this.gymManagementService=g,this.sanitizer=d,this.gymId=null,this.gymInfo=null,this.loading=!1,this.error=null,this.phoneNumber="",this.userInfo=null,this.showRegisterButton=!1,this.qrCodeDataUrl="",this.showQr=!1,this.DateUtils=b.E,this.currentUrl=""}ngOnInit(){this.refreshInfo()}refreshInfo(){var t,n;this.gymId=this.route.snapshot.queryParamMap.get("gymId"),this.phoneNumber=null!==(t=this.route.snapshot.queryParamMap.get("phoneNumber"))&&void 0!==t?t:"",""===this.phoneNumber&&(this.phoneNumber=null!==(n=localStorage.getItem("lastUsedPhoneNumber"))&&void 0!==n?n:""),this.gymId&&(localStorage.setItem("gymId",this.gymId),this.getGymInfo()),this.showCurrentUrl()}showCurrentUrl(){var t=this;return(0,I.A)(function*(){const s=window.location.href;t.currentUrl=s})()}getGymInfo(){if(!this.gymId)return void(this.error="Gym ID not found in URL");const t=localStorage.getItem("cachedGymInfo");if(t){var n=JSON.parse(t);if(this.gymId===n.gymId)return console.log("loading gym info from cache"),this.gymInfo=n,void this.getUserInfo()}this.loading=!0,this.error=null,this.gymManagementService.getGymInfo(this.gymId).subscribe({next:s=>{console.log(s),s.success?(this.loading=!1,this.gymInfo=s.gymInfo,this.phoneNumber&&this.getUserInfo(),localStorage.setItem("cachedGymInfo",JSON.stringify(this.gymInfo))):(localStorage.removeItem("cachedGymInfo"),this.error="Failed to fetch gym details")},error:s=>{localStorage.removeItem("cachedGymInfo"),this.error="An error occurred while fetching gym details",console.error(s),this.loading=!1}})}refresh(){localStorage.removeItem("cachedGymInfo"),localStorage.removeItem("cachedUserInfo"),this.gymInfo=null,this.userInfo=null,this.refreshInfo()}getUserInfo(){const t=localStorage.getItem("cachedUserInfo");if(t)return console.log("loading user info from cache"),this.userInfo=JSON.parse(t),void this.buildQRCode();this.loading=!0,this.error="",this.gymManagementService.getUserInfo(this.gymId,this.phoneNumber).subscribe(n=>{console.log(n),this.loading=!1,"success"===n.status?(this.userInfo=n.user,localStorage.setItem("cachedUserInfo",JSON.stringify(this.userInfo)),this.buildQRCode()):(localStorage.removeItem("cachedUserInfo"),this.userInfo=null)},n=>{localStorage.removeItem("cachedUserInfo"),console.log(n),this.loading=!1})}checkUser(){this.showRegisterButton=!1,this.phoneNumber?(this.loading=!0,this.error="",this.gymManagementService.getUserInfo(this.gymId,this.phoneNumber).subscribe(t=>{console.log(t),this.loading=!1,"success"===t.status?(this.userInfo=t.user,localStorage.setItem("lastUsedPhoneNumber",this.phoneNumber)):(this.showRegisterButton=!0,this.userInfo=null,this.error="User not found. Would you like to register?")},t=>{console.log(t),this.loading=!1,this.error="An error occurred while checking membership."})):this.error="Please enter a phone number."}registerUser(){this.gymId&&this.phoneNumber?this.router.navigate(["/register-user"],{queryParams:{gymId:this.gymId,phoneNumber:this.phoneNumber}}):console.error("Gym ID or Phone Number is missing.")}clearUserInfo(){this.phoneNumber="",this.userInfo=null,this.showRegisterButton=!1}buildQRCode(){if(this.userInfo){const t=JSON.stringify({userId:this.userInfo.userId}),n=btoa(t);_.toDataURL(n,{width:256},(s,l)=>{s?console.log("error while creating qr code"+s):this.qrCodeDataUrl=l})}}downloadQRCode(){var t;const n=document.createElement("a");n.href=this.qrCodeDataUrl,n.download=`${null===(t=this.userInfo)||void 0===t?void 0:t.userId}-qr.png`,n.click()}payWithUPI(){const l=this.generateRandomString(),g=this.generateRandomString(),D=window.location.href,p=`upi://pay?pa=6poornima6-1@okhdfcbank&pn=Poornima&mc=7399&tid=${l}&am=1.00&cu=INR&tn=Membership Payment&tr=${g}&url=${encodeURIComponent(D)}`;console.log(p),this.iab.create(p,"_system")}generateRandomString(){return Math.random().toString(36).substring(2,12)}callGym(t){t?window.open(`tel:${t}`,"_system"):console.error("Contact number is not available.")}emailGym(t){t?window.open(`mailto:${t}`,"_system"):console.error("Email address is not available.")}}return(r=a).\u0275fac=function(t){return new(t||r)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(y.N),e.rXU(i.hG),e.rXU(M.q),e.rXU(P.up))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-membership"]],decls:15,vars:5,consts:[["slot","start"],["slot","end"],[3,"click"],["slot","icon-only","name","refresh-outline"],[4,"ngIf"],["color","danger"],["expand","block","fill","outline","color","primary",3,"click",4,"ngIf"],["expand","block","fill","outline","color","primary",3,"click"],[1,"action-buttons"],["color","primary","fill","clear",3,"click"],["name","call","slot","start"],["position","floating"],["type","tel",3,"ngModelChange","ngModel"],["slot","end","expand","block","color","primary",3,"click"],["fill","clear",2,"position","absolute","top","0px","right","10px","z-index","10",3,"click"],["slot","icon-only",3,"name"],["class","qr-code-container","style","text-align: center",4,"ngIf"],[3,"ngStyle"],["expand","block","color","danger",3,"click"],[1,"qr-code-container",2,"text-align","center"],["alt","QR Code",3,"src",4,"ngIf"],["expand","block",3,"click"],["alt","QR Code",3,"src"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Membership"),e.k0s(),e.j41(6,"ion-buttons",1)(7,"ion-button",2),e.bIt("click",function(){return n.refresh()}),e.nrm(8,"ion-icon",3),e.k0s()()()(),e.j41(9,"ion-content"),e.DNE(10,R,1,0,"ion-spinner",4)(11,v,5,2,"ion-card",4)(12,U,11,2,"ion-card",4)(13,N,7,1,"ion-item",4)(14,j,9,4,"ion-card",4),e.k0s()),2&t&&(e.R7$(10),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.error),e.R7$(),e.Y8G("ngIf",n.gymInfo),e.R7$(),e.Y8G("ngIf",!n.userInfo),e.R7$(),e.Y8G("ngIf",n.userInfo))},dependencies:[m.bT,m.B3,u.BC,u.vS,i.Jm,i.QW,i.b_,i.I9,i.ME,i.HW,i.tN,i.W9,i.eU,i.iq,i.$w,i.uz,i.he,i.MC,i.w2,i.IO,i.BC,i.ai,i.Gw],styles:[".action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}ion-button[_ngcontent-%COMP%]{font-size:16px;height:48px;text-transform:none}.flip-container[_ngcontent-%COMP%]{position:relative;perspective:1000px}.front[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{-webkit-backface-visibility:hidden;backface-visibility:hidden;transition:transform .6s;position:absolute;width:100%}.front[_ngcontent-%COMP%]{transform:rotateY(0)}.back[_ngcontent-%COMP%]{transform:rotateY(180deg)}.flipped[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{transform:rotateY(-180deg)}.flipped[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{transform:rotateY(0)}.qr-code-container[_ngcontent-%COMP%]{text-align:center}"]}),a})()}];let E=(()=>{var r;class a{}return(r=a).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[h.iI.forChild(F),h.iI]}),a})(),$=(()=>{var r;class a{}return(r=a).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[m.MD,u.YN,i.bv,E]}),a})()}}]);