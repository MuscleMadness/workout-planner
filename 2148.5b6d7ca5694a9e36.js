"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2148],{2148:(D,h,d)=>{d.r(h),d.d(h,{RegisterUserPageModule:()=>v});var p=d(177),u=d(9417),o=d(5374),m=d(8498),c=d(467),e=d(3953);const y=()=>({days:30,amount:500}),f=()=>({days:90,amount:1400}),_=()=>({days:180,amount:2700});let b=(()=>{var s;class g{constructor(n){this.modalCtrl=n,this.selectedDuration={days:30,amount:500},this.paymentMode="Cash"}dismiss(){this.modalCtrl.dismiss()}submit(){this.modalCtrl.dismiss({userId:this.userId,days:this.selectedDuration.days,amount:this.selectedDuration.amount,paymentMode:this.paymentMode})}}return(s=g).\u0275fac=function(n){return new(n||s)(e.rXU(o.W3))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-log-payment"]],inputs:{userId:"userId"},decls:34,vars:8,consts:[["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngModelChange","ngModel"],["slot","start",3,"value"],["value","Cash"],["value","GPay"],["expand","block",1,"ion-margin-top",3,"click"]],template:function(n,t){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Log Payment"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return t.dismiss()}),e.EFF(6,"Close"),e.k0s()()()(),e.j41(7,"ion-content",2)(8,"ion-list")(9,"ion-radio-group",3),e.mxI("ngModelChange",function(a){return e.DH7(t.selectedDuration,a)||(t.selectedDuration=a),a}),e.j41(10,"ion-item")(11,"ion-label"),e.EFF(12,"1 Month (\u20b9500)"),e.k0s(),e.nrm(13,"ion-radio",4),e.k0s(),e.j41(14,"ion-item")(15,"ion-label"),e.EFF(16,"3 Months (\u20b91400)"),e.k0s(),e.nrm(17,"ion-radio",4),e.k0s(),e.j41(18,"ion-item")(19,"ion-label"),e.EFF(20,"6 Months (\u20b92700)"),e.k0s(),e.nrm(21,"ion-radio",4),e.k0s()()(),e.j41(22,"ion-item")(23,"ion-label"),e.EFF(24,"Payment Mode"),e.k0s(),e.j41(25,"ion-segment",3),e.mxI("ngModelChange",function(a){return e.DH7(t.paymentMode,a)||(t.paymentMode=a),a}),e.j41(26,"ion-segment-button",5)(27,"ion-label"),e.EFF(28,"Cash"),e.k0s()(),e.j41(29,"ion-segment-button",6)(30,"ion-label"),e.EFF(31,"GPay"),e.k0s()()()(),e.j41(32,"ion-button",7),e.bIt("click",function(){return t.submit()}),e.EFF(33,"Log Payment"),e.k0s()()),2&n&&(e.R7$(9),e.R50("ngModel",t.selectedDuration),e.R7$(4),e.Y8G("value",e.lJ4(5,y)),e.R7$(4),e.Y8G("value",e.lJ4(6,f)),e.R7$(4),e.Y8G("value",e.lJ4(7,_)),e.R7$(4),e.R50("ngModel",t.paymentMode))},dependencies:[u.BC,u.vS,o.Jm,o.QW,o.W9,o.eU,o.uz,o.he,o.nf,o.KO,o.f0,o.Gp,o.eP,o.BC,o.ai,o.Je]}),g})();var M=d(5679);const R=["dobPicker"];function I(s,g){1&s&&e.nrm(0,"ion-spinner")}function F(s,g){if(1&s&&(e.j41(0,"ion-card")(1,"ion-card-content")(2,"ion-text",24),e.EFF(3),e.k0s()()()),2&s){const l=e.XpG();e.R7$(3),e.JRh(l.error)}}function P(s,g){if(1&s&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-card-subtitle"),e.EFF(5),e.k0s()()()),2&s){const l=e.XpG();e.R7$(3),e.JRh(l.gymInfo.name),e.R7$(2),e.JRh(l.gymInfo.address)}}function C(s,g){1&s&&e.nrm(0,"ion-datetime",25,1)}function j(s,g){if(1&s){const l=e.RV6();e.j41(0,"ion-button",26),e.bIt("click",function(){e.eBV(l);const t=e.XpG();return e.Njj(t.onLogPayment())}),e.EFF(1,"Log Payment"),e.k0s()}}const k=[{path:"",component:(()=>{var s;class g{constructor(n,t,i,a,r,E){this.route=n,this.router=t,this.gymManagementService=i,this.toastController=a,this.modalController=r,this.cdr=E,this.gymId=null,this.gymInfo=null,this.loading=!1,this.error=null,this.userId=null,this.accessLevel="no-access",this.showLogPaymentButton=!1,this.user={userId:0,name:"",phoneNumber:"",email:"",dateOfBirth:"",gender:"Male",address:"",emergencyContact:"",expiryDate:"",createdDate:""}}ngOnInit(){var n;this.gymId=this.route.snapshot.queryParamMap.get("gymId"),this.gymId||(this.gymId=localStorage.getItem("gymId")),this.gymId&&this.getGymInfo();const t=this.router.getCurrentNavigation();null!=t&&null!==(n=t.extras.state)&&void 0!==n&&n.user&&(this.user=t.extras.state.user,console.log("User object received:",this.user),this.userId=String(this.user.userId),this.cdr.detectChanges()),this.loadSessionDetails()}loadSessionDetails(){var n;this.accessLevel=null!==(n=localStorage.getItem("role"))&&void 0!==n?n:"no-access";var t=localStorage.getItem("role");console.log("Access Level:",t),this.showLogPaymentButton="owner"===this.accessLevel||"editor"===this.accessLevel}getGymInfo(){this.gymId?(this.loading=!0,this.error=null,this.gymManagementService.getGymInfo(this.gymId).subscribe({next:n=>{console.log(n),n.success?this.gymInfo=n.gymInfo:this.error="Failed to fetch gym details",this.loading=!1},error:n=>{this.error="An error occurred while fetching gym details",console.error(n),this.loading=!1}})):this.error="Gym ID not found in URL"}loadUserDetails(n){this.loading=!0,this.error="",this.gymManagementService.getUserInfo(this.gymId,this.userId).subscribe(t=>{console.log(t),this.loading=!1,"success"===t.status?this.user=t.user:this.error="User not found"},t=>{console.log(t),this.loading=!1,this.error="Failed to fetch user details"})}submitForm(){this.user.name&&this.user.phoneNumber?(this.dobPicker&&(this.user.dateOfBirth="string"==typeof this.dobPicker.value?this.dobPicker.value:""),console.log("User Data:",this.user),this.loading=!0,this.error=null,this.userId?this.updateUser():this.registerUser()):this.error="Name and Phone Number are mandatory."}updateUser(){this.gymManagementService.updateUser(this.gymId,this.user).subscribe({next:n=>{this.loading=!1,console.log("User data successfully:",n),this.router.navigate(["/dashboard"])},error:n=>{this.loading=!1,this.error="Failed to save user. Please try again.",console.error("Error while saving user data:",n)}})}registerUser(){this.gymManagementService.registerUser(this.gymId,this.user).subscribe({next:n=>{this.loading=!1,console.log("User registered successfully:",n),this.router.navigate(["/membership"],{queryParams:{gymId:this.gymId,phoneNumber:n.phoneNumber}}).then(()=>{window.location.reload()})},error:n=>{this.loading=!1,this.error="Failed to register user. Please try again.",console.error("Registration error:",n)}})}onLogPayment(){var n=this;return(0,c.A)(function*(){yield n.openPaymentModal(n.userId)})()}openPaymentModal(n){var t=this;return(0,c.A)(function*(){const i=yield t.modalController.create({component:b,componentProps:{userId:n}});yield i.present();const{data:a}=yield i.onDidDismiss();a&&(t.loading=!0,t.error=null,t.gymManagementService.logPayment(t.gymId,a).subscribe({next:()=>{t.loading=!1,t.toastController.create(),t.showToast("Payment logged successfully.","success")},error:r=>{t.loading=!1,t.error=r,t.showToast("Error logging payment: "+r,"danger")}}))})()}showToast(n,t="success"){var i=this;return(0,c.A)(function*(){yield(yield i.toastController.create({message:n,duration:2e3,color:t,position:"bottom"})).present()})()}}return(s=g).\u0275fac=function(n){return new(n||s)(e.rXU(m.nX),e.rXU(m.Ix),e.rXU(M.q),e.rXU(o.K_),e.rXU(o.W3),e.rXU(e.gRc))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-register-user"]],viewQuery:function(n,t){if(1&n&&e.GBs(R,5),2&n){let i;e.mGM(i=e.lsd())&&(t.dobPicker=i.first)}},decls:59,vars:14,consts:[["registerForm","ngForm"],["dobPicker",""],["slot","start"],["defaultHref","/membership"],[4,"ngIf"],[3,"ngSubmit"],["position","floating"],["type","text","required","","name","name",3,"ngModelChange","ngModel"],["type","tel","required","","name","phoneNumber",3,"ngModelChange","ngModel"],["datetime","dob-datetime","presentation","date"],[3,"keepContentsMounted"],["value","optional"],["slot","header"],["slot","content"],["name","gender",3,"ngModelChange","ngModel"],["value","Male"],["value","Female"],["value","Other"],["type","email","name","email",3,"ngModelChange","ngModel"],["name","address",3,"ngModelChange","ngModel"],["type","tel","name","emergencyContact",3,"ngModelChange","ngModel"],[1,"button-container"],["expand","block","color","primary","type","submit",3,"disabled"],["expand","block","color","primary",3,"click",4,"ngIf"],["color","danger"],["id","dob-datetime","presentation","date","name","dob"],["expand","block","color","primary",3,"click"]],template:function(n,t){if(1&n){const i=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,I,1,0,"ion-spinner",4)(8,F,4,1,"ion-card",4)(9,P,6,2,"ion-card",4),e.j41(10,"form",5,0),e.bIt("ngSubmit",function(){return e.eBV(i),e.Njj(t.submitForm())}),e.j41(12,"ion-list")(13,"ion-item")(14,"ion-label",6),e.EFF(15,"Name *"),e.k0s(),e.j41(16,"ion-input",7),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(t.user.name,r)||(t.user.name=r),e.Njj(r)}),e.k0s()(),e.j41(17,"ion-item")(18,"ion-label",6),e.EFF(19,"Phone Number *"),e.k0s(),e.j41(20,"ion-input",8),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(t.user.phoneNumber,r)||(t.user.phoneNumber=r),e.Njj(r)}),e.k0s()(),e.j41(21,"ion-item")(22,"ion-label"),e.EFF(23,"Date of Birth"),e.k0s(),e.nrm(24,"ion-datetime-button",9),e.j41(25,"ion-modal",10),e.DNE(26,C,2,0,"ng-template"),e.k0s()(),e.j41(27,"ion-accordion-group")(28,"ion-accordion",11)(29,"ion-item",12)(30,"ion-label"),e.EFF(31,"Optional Details"),e.k0s()(),e.j41(32,"div",13)(33,"ion-item")(34,"ion-label",6),e.EFF(35,"Gender"),e.k0s(),e.j41(36,"ion-select",14),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(t.user.gender,r)||(t.user.gender=r),e.Njj(r)}),e.j41(37,"ion-select-option",15),e.EFF(38,"Male"),e.k0s(),e.j41(39,"ion-select-option",16),e.EFF(40,"Female"),e.k0s(),e.j41(41,"ion-select-option",17),e.EFF(42,"Other"),e.k0s()()(),e.j41(43,"ion-item")(44,"ion-label",6),e.EFF(45,"Email"),e.k0s(),e.j41(46,"ion-input",18),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(t.user.email,r)||(t.user.email=r),e.Njj(r)}),e.k0s()(),e.j41(47,"ion-item")(48,"ion-label",6),e.EFF(49,"Address"),e.k0s(),e.j41(50,"ion-textarea",19),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(t.user.address,r)||(t.user.address=r),e.Njj(r)}),e.k0s()(),e.j41(51,"ion-item")(52,"ion-label",6),e.EFF(53,"Emergency Contact"),e.k0s(),e.j41(54,"ion-input",20),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(t.user.emergencyContact,r)||(t.user.emergencyContact=r),e.Njj(r)}),e.k0s()()()()()(),e.j41(55,"div",21)(56,"ion-button",22),e.EFF(57),e.k0s(),e.DNE(58,j,2,0,"ion-button",23),e.k0s()()()}if(2&n){const i=e.sdS(11);e.R7$(5),e.SpI(" ",t.userId?"Edit":"Register",""),e.R7$(2),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",t.error),e.R7$(),e.Y8G("ngIf",t.gymInfo),e.R7$(7),e.R50("ngModel",t.user.name),e.R7$(4),e.R50("ngModel",t.user.phoneNumber),e.R7$(5),e.Y8G("keepContentsMounted",!0),e.R7$(11),e.R50("ngModel",t.user.gender),e.R7$(10),e.R50("ngModel",t.user.email),e.R7$(4),e.R50("ngModel",t.user.address),e.R7$(4),e.R50("ngModel",t.user.emergencyContact),e.R7$(2),e.Y8G("disabled",!i.form.valid),e.R7$(),e.SpI(" ",t.userId?"Save":"Register",""),e.R7$(),e.Y8G("ngIf",t.showLogPaymentButton)}},dependencies:[p.bT,u.qT,u.BC,u.cb,u.YS,u.vS,u.cV,o.xk,o.YH,o.Jm,o.QW,o.b_,o.I9,o.ME,o.HW,o.tN,o.W9,o.A9,o.K4,o.eU,o.$w,o.uz,o.he,o.nf,o.Nm,o.Ip,o.w2,o.IO,o.nc,o.BC,o.ai,o.Sb,o.Je,o.Gw,o.el]}),g})()}];let U=(()=>{var s;class g{}return(s=g).\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[m.iI.forChild(k),m.iI]}),g})(),v=(()=>{var s;class g{}return(s=g).\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[p.MD,u.YN,o.bv,U]}),g})()}}]);