"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2293],{2293:(O,d,c)=>{c.r(d),c.d(d,{MembershipPageModule:()=>j});var m=c(177),p=c(9417),i=c(5374),h=c(8498),I=c(467),b=c(6098),_=c(5933),e=c(3953),y=c(9747),M=c(5679),P=c(345);function R(n,s){1&n&&e.nrm(0,"ion-spinner")}function v(n,s){if(1&n){const r=e.RV6();e.j41(0,"ion-button",7),e.bIt("click",function(){e.eBV(r);const o=e.XpG(2);return e.Njj(o.registerUser())}),e.EFF(1,"Register"),e.k0s()}}function U(n,s){if(1&n&&(e.j41(0,"ion-card")(1,"ion-card-content")(2,"ion-text",5),e.EFF(3),e.k0s(),e.DNE(4,v,2,0,"ion-button",6),e.k0s()()),2&n){const r=e.XpG();e.R7$(3),e.JRh(r.error),e.R7$(),e.Y8G("ngIf",r.showRegisterButton)}}function k(n,s){if(1&n){const r=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-card-subtitle"),e.EFF(5),e.k0s()(),e.j41(6,"ion-card-content")(7,"div",8)(8,"ion-button",9),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.callGym(o.gymInfo.contactNumber))}),e.nrm(9,"ion-icon",10),e.EFF(10," Call "),e.k0s()()()()}if(2&n){const r=e.XpG();e.R7$(3),e.JRh(r.gymInfo.name),e.R7$(2),e.JRh(r.gymInfo.address)}}function N(n,s){if(1&n){const r=e.RV6();e.j41(0,"div")(1,"p")(2,"strong"),e.EFF(3,"Phone:"),e.k0s(),e.EFF(4),e.k0s(),e.j41(5,"p")(6,"strong"),e.EFF(7,"Address:"),e.k0s(),e.EFF(8),e.k0s(),e.j41(9,"p")(10,"strong"),e.EFF(11,"Membership:"),e.k0s(),e.j41(12,"ion-text",14),e.EFF(13),e.k0s()(),e.j41(14,"ion-button",15),e.bIt("click",function(){e.eBV(r);const o=e.XpG(2);return e.Njj(o.clearUserInfo())}),e.EFF(15," Log out "),e.k0s()()}if(2&n){const r=e.XpG(2);e.R7$(4),e.SpI(" ",r.userInfo.phoneNumber,""),e.R7$(4),e.SpI(" ",r.userInfo.address,""),e.R7$(4),e.Y8G("ngStyle",r.DateUtils.getExpiryStyle(r.DateUtils.calculateExpiryInDays(r.userInfo.expiryDate))),e.R7$(),e.SpI(" ",r.DateUtils.getExpiryStatus(r.DateUtils.calculateExpiryInDays(r.userInfo.expiryDate))," ")}}function x(n,s){if(1&n&&e.nrm(0,"img",19),2&n){const r=e.XpG(3);e.Y8G("src",r.qrCodeDataUrl,e.B4B)}}function C(n,s){if(1&n){const r=e.RV6();e.j41(0,"div",16),e.DNE(1,x,1,1,"img",17),e.j41(2,"ion-button",18),e.bIt("click",function(){e.eBV(r);const o=e.XpG(2);return e.Njj(o.downloadQRCode())}),e.EFF(3," Download QR "),e.k0s()()}if(2&n){const r=e.XpG(2);e.R7$(),e.Y8G("ngIf",r.qrCodeDataUrl)}}function G(n,s){if(1&n){const r=e.RV6();e.j41(0,"ion-card")(1,"ion-button",11),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.showQr=!o.showQr)}),e.nrm(2,"ion-icon",12),e.k0s(),e.j41(3,"ion-card-header")(4,"ion-card-title"),e.EFF(5),e.k0s()(),e.j41(6,"ion-card-content"),e.DNE(7,N,16,4,"div",4)(8,C,4,1,"div",13),e.k0s()()}if(2&n){const r=e.XpG();e.R7$(2),e.Y8G("name",r.showQr?"person-circle-outline":"qr-code-outline"),e.R7$(3),e.SpI(" ",r.userInfo.name," "),e.R7$(2),e.Y8G("ngIf",!r.showQr),e.R7$(),e.Y8G("ngIf",r.showQr)}}const F=[{path:"",component:(()=>{var n;class s{constructor(t,o,a,l,u,g){this.route=t,this.router=o,this.iab=a,this.alertController=l,this.gymManagementService=u,this.sanitizer=g,this.gymId=null,this.gymInfo=null,this.loading=!1,this.error=null,this.phoneNumber="",this.userInfo=null,this.showRegisterButton=!1,this.qrCodeDataUrl="",this.showQr=!1,this.DateUtils=b.E,this.currentUrl=""}ngOnInit(){var t,o;this.gymId=this.route.snapshot.queryParamMap.get("gymId"),this.phoneNumber=null!==(t=this.route.snapshot.queryParamMap.get("phoneNumber"))&&void 0!==t?t:"",""===this.phoneNumber&&(this.phoneNumber=null!==(o=localStorage.getItem("lastUsedPhoneNumber"))&&void 0!==o?o:""),this.gymId&&(localStorage.setItem("gymId",this.gymId),this.getGymInfo()),this.showCurrentUrl()}showCurrentUrl(){var t=this;return(0,I.A)(function*(){const a=window.location.href;t.currentUrl=a})()}getGymInfo(){if(!this.gymId)return void(this.error="Gym ID not found in URL");const t=localStorage.getItem("cachedGymInfo");if(t){var o=JSON.parse(t);if(this.gymId===o.gymId)return console.log("loading gym info from cache"),this.gymInfo=o,void this.getUserInfo()}this.loading=!0,this.error=null,this.gymManagementService.getGymInfo(this.gymId).subscribe({next:a=>{console.log(a),a.success?(this.loading=!1,this.gymInfo=a.gymInfo,this.phoneNumber&&this.getUserInfo(),localStorage.setItem("cachedGymInfo",JSON.stringify(this.gymInfo))):(localStorage.removeItem("cachedGymInfo"),this.error="Failed to fetch gym details")},error:a=>{localStorage.removeItem("cachedGymInfo"),this.error="An error occurred while fetching gym details",console.error(a),this.loading=!1}})}refresh(){localStorage.removeItem("cachedGymInfo"),localStorage.removeItem("cachedUserInfo"),this.gymInfo=null,this.userInfo=null,this.getGymInfo()}getUserInfo(){const t=localStorage.getItem("cachedUserInfo");if(t)return console.log("loading user info from cache"),this.userInfo=JSON.parse(t),void this.buildQRCode();this.loading=!0,this.error="",this.gymManagementService.getUserInfo(this.gymId,this.phoneNumber).subscribe(o=>{console.log(o),this.loading=!1,"success"===o.status?(this.userInfo=o.user,localStorage.setItem("cachedUserInfo",JSON.stringify(this.userInfo)),this.buildQRCode()):(localStorage.removeItem("cachedUserInfo"),this.userInfo=null,this.phoneNumber="")},o=>{localStorage.removeItem("cachedUserInfo"),console.log(o),this.loading=!1,this.phoneNumber=""})}checkUser(){this.showRegisterButton=!1,this.phoneNumber?(this.loading=!0,this.error="",this.gymManagementService.getUserInfo(this.gymId,this.phoneNumber).subscribe(t=>{console.log(t),this.loading=!1,"success"===t.status?(this.userInfo=t.user,localStorage.setItem("lastUsedPhoneNumber",this.phoneNumber)):(this.showRegisterButton=!0,this.userInfo=null,this.error="User not found. Would you like to register?")},t=>{console.log(t),this.loading=!1,this.error="An error occurred while checking membership."})):this.error="Please enter a phone number."}registerUser(){this.gymId&&this.phoneNumber?this.router.navigate(["/register-user"],{queryParams:{gymId:this.gymId,phoneNumber:this.phoneNumber}}):console.error("Gym ID or Phone Number is missing.")}clearUserInfo(){this.phoneNumber="",this.userInfo=null,this.showRegisterButton=!1}buildQRCode(){if(this.userInfo){const t=JSON.stringify({userId:this.userInfo.userId}),o=btoa(t);_.toDataURL(o,{width:256},(a,l)=>{a?console.log("error while creating qr code"+a):this.qrCodeDataUrl=l})}}downloadQRCode(){var t;const o=document.createElement("a");o.href=this.qrCodeDataUrl,o.download=`${null===(t=this.userInfo)||void 0===t?void 0:t.userId}-qr.png`,o.click()}payWithUPI(){const l=this.generateRandomString(),u=this.generateRandomString(),w=window.location.href,f=`upi://pay?pa=6poornima6-1@okhdfcbank&pn=Poornima&mc=7399&tid=${l}&am=1.00&cu=INR&tn=Membership Payment&tr=${u}&url=${encodeURIComponent(w)}`;console.log(f),this.iab.create(f,"_system")}generateRandomString(){return Math.random().toString(36).substring(2,12)}callGym(t){t?window.open(`tel:${t}`,"_system"):console.error("Contact number is not available.")}emailGym(t){t?window.open(`mailto:${t}`,"_system"):console.error("Email address is not available.")}}return(n=s).\u0275fac=function(t){return new(t||n)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(y.N),e.rXU(i.hG),e.rXU(M.q),e.rXU(P.up))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-membership"]],decls:14,vars:4,consts:[["slot","start"],["slot","end"],[3,"click"],["slot","icon-only","name","refresh-outline"],[4,"ngIf"],["color","danger"],["expand","block","fill","outline","color","primary",3,"click",4,"ngIf"],["expand","block","fill","outline","color","primary",3,"click"],[1,"action-buttons"],["color","primary","fill","clear",3,"click"],["name","call","slot","start"],["fill","clear",2,"position","absolute","top","0px","right","10px","z-index","10",3,"click"],["slot","icon-only",3,"name"],["class","qr-code-container","style","text-align: center",4,"ngIf"],[3,"ngStyle"],["expand","block","color","danger",3,"click"],[1,"qr-code-container",2,"text-align","center"],["alt","QR Code",3,"src",4,"ngIf"],["expand","block",3,"click"],["alt","QR Code",3,"src"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Membership"),e.k0s(),e.j41(6,"ion-buttons",1)(7,"ion-button",2),e.bIt("click",function(){return o.refresh()}),e.nrm(8,"ion-icon",3),e.k0s()()()(),e.j41(9,"ion-content"),e.DNE(10,R,1,0,"ion-spinner",4)(11,U,5,2,"ion-card",4)(12,k,11,2,"ion-card",4)(13,G,9,4,"ion-card",4),e.k0s()),2&t&&(e.R7$(10),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",o.error),e.R7$(),e.Y8G("ngIf",o.gymInfo),e.R7$(),e.Y8G("ngIf",o.userInfo))},dependencies:[m.bT,m.B3,i.Jm,i.QW,i.b_,i.I9,i.ME,i.HW,i.tN,i.W9,i.eU,i.iq,i.MC,i.w2,i.IO,i.BC,i.ai],styles:[".action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}ion-button[_ngcontent-%COMP%]{font-size:16px;height:48px;text-transform:none}.flip-container[_ngcontent-%COMP%]{position:relative;perspective:1000px}.front[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{-webkit-backface-visibility:hidden;backface-visibility:hidden;transition:transform .6s;position:absolute;width:100%}.front[_ngcontent-%COMP%]{transform:rotateY(0)}.back[_ngcontent-%COMP%]{transform:rotateY(180deg)}.flipped[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%]{transform:rotateY(-180deg)}.flipped[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{transform:rotateY(0)}.qr-code-container[_ngcontent-%COMP%]{text-align:center}"]}),s})()}];let $=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.iI.forChild(F),h.iI]}),s})(),j=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.MD,p.YN,i.bv,$]}),s})()}}]);